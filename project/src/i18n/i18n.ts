export type Language = 'zh' | 'en' | 'ja';

type Dictionary = Record<string, string>;

const dictionaries: Record<Language, Dictionary> = {
  zh: {
    app_title: '五十音图学习',
    kana_hiragana: '平假名',
    kana_katakana: '片假名',
    nav_learn: '学习',
    nav_quiz: '测验',
    nav_greetings: '寒暄语',
    nav_practice: '练习',
    nav_profile: '个人信息',
    nav_page: '页面',
    chart_title_suffix: '五十音图',
    chart_subtitle: '点击假名听发音，可以为每个假名添加你的记忆方法',

    practice_title: '练习',
    practice_subtitle: '通过填空与默写巩固假名记忆。',
    practice_tab_fill: '随机填空',
    practice_tab_dictation: '默写',
    practice_tab_quiz: '测验',
    quiz_title: '假名测验',
    quiz_subtitle_prefix: '随机出题，包括假名识别、听力测验和单词识别。测试你对',
    quiz_subtitle_suffix: '的掌握程度',
    quiz_tip: '提示：超过10秒未作答可以查看你的备注',
    greetings_title: '日常寒暄语',
    greetings_subtitle: '学习日常生活中常用的日语表达，点击喇叭图标听发音',
    quiz_loading: '加载中...',
    quiz_score: '得分',
    quiz_time: '时间',
    quiz_seconds: '秒',
    quiz_prompt_visual: '看假名选罗马音',
    quiz_prompt_audio: '听假名选假名',
    quiz_prompt_vocab: '看日语单词选假名',
    quiz_show_hint: '显示提示',
    quiz_your_notes: '你的备注：',
    quiz_next: '下一题',
    greetings_category_greeting: '日常问候',
    greetings_category_polite: '礼貌用语',
    greetings_category_casual: '随意表达',
    greetings_category_gratitude: '感谢表达',
    greetings_category_apology: '道歉用语',
    speak: '发音',
    lang_label: '语言',
    bg_change: '选择背景',
    bg_clear: '清除背景',
    bg_position_modal_title: '调整背景显示位置',
    bg_position_drag_hint: '拖动调整位置，滚轮或滑块缩放',
    bg_position_confirm: '确定',
    bg_scale: '缩放',
    bg_opacity: '背景透明度',
    bg_opacity_hint: '调低则背景变淡、内容更易阅读；调高则背景更明显。',
    appearance: '外观',
    close: '关闭',
    bg_section: '背景',
    chart_row: '行',
    chart_row_n: 'N',
    chart_row_other: '其他',
    chart_row_yoon: '拗音',

    practice_fill_title: '随机顺序五十音填空',
    practice_fill_subtitle: '根据罗马音填写对应假名（随机抽取部分格子）。',
    practice_dictation_title: '五十音默写',
    practice_dictation_subtitle: '根据提示输入对应假名（可切换罗马音/语音模式）。',
    practice_dictation_mode_romaji: '罗马音',
    practice_dictation_mode_audio: '语音',
    practice_dictation_prompt_romaji: '根据罗马音默写假名',
    practice_dictation_prompt_audio: '听提示默写假名',
    practice_dictation_placeholder: '输入假名',
    practice_score: '得分',
    practice_time_left: '剩余时间',
    practice_check: '检查答案',
    practice_new_round: '换一组',
    practice_next: '下一题',
    practice_fill_placeholder: '输入假名',
    practice_correct: '正确答案',
    practice_timer_label: '计时器',
    auth_login: '登录',
    auth_register: '注册',
    auth_logout: '登出',
    auth_logout_confirm_title: '确认退出登录',
    auth_logout_confirm_message: '确定要退出登录吗？退出后需要重新登录才能使用。',
    auth_logout_confirm_button: '确认退出',
    auth_email: '邮箱',
    auth_password: '密码',
    auth_display_name: '显示名称（可选）',
    auth_login_title: '登录',
    auth_register_title: '注册',
    auth_login_button: '登录',
    auth_register_button: '注册',
    auth_cancel_button: '取消',
    auth_switch_to_login: '已有账号？登录',
    auth_switch_to_register: '没有账号？注册',
    auth_login_subtitle: '欢迎回来，请登录您的账户',
    auth_register_subtitle: '创建新账户开始学习',
    auth_email_placeholder: '请输入邮箱',
    auth_password_placeholder: '8-16位，含数字、英文、特殊字符',
    auth_password_rule_length: '8-16 位',
    auth_password_rule_digit: '包含数字',
    auth_password_rule_letter: '包含英文字母',
    auth_password_rule_special: '包含特殊字符',
    auth_confirm_password: '确认密码',
    auth_confirm_match: '密码一致',
    auth_confirm_mismatch: '两次密码不一致',
    auth_captcha_label: '验证码',
    auth_captcha_placeholder: '请输入图片中的字符',
    auth_captcha_refresh: '换一张',
    auth_error_invalid_captcha: '验证码错误或已过期，请重新获取',
    auth_confirm_password_placeholder: '请再次输入密码',
    auth_show_password: '显示密码',
    auth_hide_password: '隐藏密码',
    auth_display_name_placeholder: '您的昵称',
    auth_error_invalid_credentials: '邮箱或密码错误',
    auth_error_user_not_found: '用户不存在',
    auth_error_wrong_password: '密码错误',
    auth_error_password_mismatch: '两次输入的密码不一致',
    auth_login_success: '登录成功',
    auth_register_success: '注册成功，请登录',
    auth_error_weak_password: '密码需为 8-16 位，且包含数字、英文字母和特殊字符',
    auth_error_email_taken: '该邮箱已被使用',
    auth_error_invalid_email: '请输入有效的邮箱格式',
    auth_error_invalid_input: '输入无效',
    auth_error_unauthorized: '未授权',
    auth_error_request_failed: '请求失败',
    auth_error_login_failed: '登录失败',
    auth_error_register_failed: '注册失败',
    auth_error_logout_failed: '登出失败',
    auth_error_network: '网络错误',
    auth_error_unknown: '未知错误',
    auth_loading: '加载中...',
    profile_title: '个人信息',
    profile_display_name: '昵称',
    profile_display_name_placeholder: '输入昵称',
    profile_display_name_rule: '1-20 字符，仅允许字母、数字、空格及 - _ .',
    profile_error_invalid_display_name: '昵称格式无效，请使用 1-20 个字符，仅支持字母、数字、空格及 - _ .',
    profile_save: '保存',
    profile_saved: '已保存',
    note_hiragana_label: '平假名备注',
    note_katakana_label: '片假名备注',
    note_placeholder: '添加你的记忆方法...',
    note_image_label: '图片备注',
    note_add_image: '添加图片',
    note_delete: '删除',
    note_save: '保存',
    note_cancel: '取消',
    note_hiragana_short: '平',
    note_katakana_short: '片',
    note_image_only: '（仅图片备注）',
    note_add_hiragana: '添加平假名备注',
    note_add_katakana: '添加片假名备注',
    note_label: '备注',
    note_view_image: '查看大图',
    note_prev_image: '上一张',
    note_next_image: '下一张',
  },
  en: {
    app_title: 'Gojuon Study',
    kana_hiragana: 'Hiragana',
    kana_katakana: 'Katakana',
    nav_learn: 'Learn',
    nav_quiz: 'Quiz',
    nav_greetings: 'Greetings',
    nav_practice: 'Practice',
    nav_profile: 'Profile',
    nav_page: 'Page',
    chart_title_suffix: 'Chart',
    chart_subtitle: 'Click a kana to hear pronunciation, and add your own mnemonic notes.',

    practice_title: 'Practice',
    practice_subtitle: 'Improve your kana with fill-in and dictation exercises.',
    practice_tab_fill: 'Fill-in',
    practice_tab_dictation: 'Dictation',
    practice_tab_quiz: 'Quiz',
    quiz_title: 'Kana Quiz',
    quiz_subtitle_prefix: 'Random questions including recognition, listening, and vocabulary. Test your knowledge of ',
    quiz_subtitle_suffix: '.',
    quiz_tip: 'Tip: After 10 seconds you can view your notes as hints.',
    greetings_title: 'Daily Greetings',
    greetings_subtitle: 'Learn common Japanese expressions. Click the speaker icon to hear pronunciation.',
    quiz_loading: 'Loading...',
    quiz_score: 'Score',
    quiz_time: 'Time',
    quiz_seconds: 's',
    quiz_prompt_visual: 'Choose the romaji for the kana',
    quiz_prompt_audio: 'Listen and choose the kana',
    quiz_prompt_vocab: 'Choose the kana for the word',
    quiz_show_hint: 'Show hint',
    quiz_your_notes: 'Your notes:',
    quiz_next: 'Next',
    greetings_category_greeting: 'Greetings',
    greetings_category_polite: 'Polite phrases',
    greetings_category_casual: 'Casual phrases',
    greetings_category_gratitude: 'Gratitude',
    greetings_category_apology: 'Apologies',
    speak: 'Speak',
    lang_label: 'Language',
    bg_change: 'Select background',
    bg_clear: 'Clear background',
    bg_position_modal_title: 'Adjust background position',
    bg_position_drag_hint: 'Drag to move, scroll or slider to zoom',
    bg_position_confirm: 'Confirm',
    bg_scale: 'Zoom',
    bg_opacity: 'Background opacity',
    bg_opacity_hint: 'Lower = background fades, content easier to read; Higher = background more prominent.',
    appearance: 'Appearance',
    close: 'Close',
    bg_section: 'Background',
    chart_row: 'row',
    chart_row_n: 'N',
    chart_row_other: 'Other',
    chart_row_yoon: 'Yōon',

    practice_fill_title: 'Random Kana Fill-in',
    practice_fill_subtitle: 'Fill the kana based on romaji (random blanks).',
    practice_dictation_title: 'Kana Dictation',
    practice_dictation_subtitle: 'Type the correct kana (switch between romaji/audio mode).',
    practice_dictation_mode_romaji: 'Romaji',
    practice_dictation_mode_audio: 'Audio',
    practice_dictation_prompt_romaji: 'Write the kana from romaji',
    practice_dictation_prompt_audio: 'Listen and write the kana',
    practice_dictation_placeholder: 'Type kana',
    practice_score: 'Score',
    practice_time_left: 'Time left',
    practice_check: 'Check',
    practice_new_round: 'New Round',
    practice_next: 'Next',
    practice_fill_placeholder: 'Type kana',
    practice_correct: 'Correct',
    practice_timer_label: 'Timer',
    auth_login: 'Login',
    auth_register: 'Register',
    auth_logout: 'Logout',
    auth_logout_confirm_title: 'Confirm Logout',
    auth_logout_confirm_message: 'Are you sure you want to logout? You will need to login again to continue.',
    auth_logout_confirm_button: 'Confirm Logout',
    auth_email: 'Email',
    auth_password: 'Password',
    auth_display_name: 'Display name (optional)',
    auth_login_title: 'Login',
    auth_register_title: 'Register',
    auth_login_button: 'Login',
    auth_register_button: 'Register',
    auth_cancel_button: 'Cancel',
    auth_switch_to_login: 'Already have an account? Login',
    auth_switch_to_register: 'No account? Register',
    auth_login_subtitle: 'Welcome back, please sign in to your account',
    auth_register_subtitle: 'Create a new account to start learning',
    auth_email_placeholder: 'Enter your email',
    auth_password_placeholder: '8-16 chars, include number, letter, special',
    auth_password_rule_length: '8-16 characters',
    auth_password_rule_digit: 'Include a number',
    auth_password_rule_letter: 'Include a letter',
    auth_password_rule_special: 'Include a special character',
    auth_confirm_password: 'Confirm password',
    auth_confirm_match: 'Passwords match',
    auth_confirm_mismatch: 'Passwords do not match',
    auth_captcha_label: 'Captcha',
    auth_captcha_placeholder: 'Enter the characters in the image',
    auth_captcha_refresh: 'Refresh',
    auth_confirm_password_placeholder: 'Enter password again',
    auth_show_password: 'Show password',
    auth_hide_password: 'Hide password',
    auth_display_name_placeholder: 'Your nickname',
    auth_error_invalid_credentials: 'Email or password incorrect',
    auth_error_user_not_found: 'User not found',
    auth_error_wrong_password: 'Wrong password',
    auth_error_password_mismatch: 'Passwords do not match',
    auth_login_success: 'Login successful',
    auth_register_success: 'Registration successful, please login',
    auth_error_weak_password: 'Password must be 8-16 characters and include number, letter and special character',
    auth_error_invalid_captcha: 'Invalid or expired captcha, please refresh',
    auth_error_email_taken: 'This email is already in use',
    auth_error_invalid_email: 'Please enter a valid email address',
    auth_error_invalid_input: 'Invalid input',
    auth_error_unauthorized: 'Unauthorized',
    auth_error_request_failed: 'Request failed',
    auth_error_login_failed: 'Login failed',
    auth_error_register_failed: 'Registration failed',
    auth_error_logout_failed: 'Logout failed',
    auth_error_network: 'Network error',
    auth_error_unknown: 'Unknown error',
    auth_loading: 'Loading...',
    profile_title: 'Profile',
    profile_display_name: 'Display name',
    profile_display_name_placeholder: 'Enter display name',
    profile_display_name_rule: '1-20 chars, letters, numbers, spaces, - _ . only',
    profile_error_invalid_display_name: 'Invalid format. Use 1-20 chars: letters, numbers, spaces, - _ . only',
    profile_save: 'Save',
    profile_saved: 'Saved',
    note_hiragana_label: 'Hiragana note',
    note_katakana_label: 'Katakana note',
    note_placeholder: 'Add your mnemonic...',
    note_image_label: 'Image note',
    note_add_image: 'Add image',
    note_delete: 'Delete',
    note_save: 'Save',
    note_cancel: 'Cancel',
    note_hiragana_short: 'H',
    note_katakana_short: 'K',
    note_image_only: '(Image only)',
    note_add_hiragana: 'Add hiragana note',
    note_add_katakana: 'Add katakana note',
    note_label: 'Note',
    note_view_image: 'View full size',
    note_prev_image: 'Previous',
    note_next_image: 'Next',
  },
  ja: {
    app_title: '五十音図学習',
    kana_hiragana: 'ひらがな',
    kana_katakana: 'カタカナ',
    nav_learn: '学習',
    nav_quiz: 'クイズ',
    nav_greetings: '挨拶',
    nav_practice: '練習',
    nav_profile: 'プロフィール',
    nav_page: 'ページ',
    chart_title_suffix: '五十音図',
    chart_subtitle: '仮名をクリックして発音を聞き、メモを追加できます。',

    practice_title: '練習',
    practice_subtitle: '穴埋めとディクテーションで仮名を習得。',
    practice_tab_fill: '穴埋め',
    practice_tab_dictation: 'ディクテーション',
    practice_tab_quiz: 'クイズ',
    quiz_title: '仮名クイズ',
    quiz_subtitle_prefix: 'ランダム出題。',
    quiz_subtitle_suffix: 'の習得度をテスト',
    quiz_tip: 'ヒント：10秒後にメモを表示できます',
    greetings_title: '日常挨拶',
    greetings_subtitle: 'よく使う日本語表現を学びましょう。スピーカーアイコンで発音を聞けます。',
    quiz_loading: '読み込み中...',
    quiz_score: 'スコア',
    quiz_time: '時間',
    quiz_seconds: '秒',
    quiz_prompt_visual: '仮名のローマ字を選ぶ',
    quiz_prompt_audio: '聞いて仮名を選ぶ',
    quiz_prompt_vocab: '単語の仮名を選ぶ',
    quiz_show_hint: 'ヒント表示',
    quiz_your_notes: 'メモ：',
    quiz_next: '次へ',
    greetings_category_greeting: '挨拶',
    greetings_category_polite: '丁寧な表現',
    greetings_category_casual: 'カジュアルな表現',
    greetings_category_gratitude: '感謝',
    greetings_category_apology: '謝罪',
    speak: '発音',
    lang_label: '言語',
    bg_change: '背景を選択',
    bg_clear: '背景を削除',
    bg_position_modal_title: '背景の位置を調整',
    bg_position_drag_hint: 'ドラッグで移動、スクロールでズーム',
    bg_position_confirm: '確定',
    bg_scale: 'ズーム',
    bg_opacity: '背景の透明度',
    bg_opacity_hint: '低くすると背景が薄くなり読みやすく、高くすると背景が目立ちます。',
    appearance: '外観',
    close: '閉じる',
    bg_section: '背景',
    chart_row: '行',
    chart_row_n: 'N',
    chart_row_other: 'その他',
    chart_row_yoon: '拗音',

    practice_fill_title: 'ランダム五十音穴埋め',
    practice_fill_subtitle: 'ローマ字に合わせて仮名を入力（ランダムな空欄）。',
    practice_dictation_title: '五十音ディクテーション',
    practice_dictation_subtitle: '正しい仮名を入力（ローマ字/音声モード切替可）。',
    practice_dictation_mode_romaji: 'ローマ字',
    practice_dictation_mode_audio: '音声',
    practice_dictation_prompt_romaji: 'ローマ字から仮名を書く',
    practice_dictation_prompt_audio: '聞いて仮名を書く',
    practice_dictation_placeholder: '仮名を入力',
    practice_score: 'スコア',
    practice_time_left: '残り時間',
    practice_check: '確認',
    practice_new_round: '新しいラウンド',
    practice_next: '次へ',
    practice_fill_placeholder: '仮名を入力',
    practice_correct: '正解',
    practice_timer_label: 'タイマー',
    auth_login: 'ログイン',
    auth_register: '登録',
    auth_logout: 'ログアウト',
    auth_logout_confirm_title: 'ログアウトの確認',
    auth_logout_confirm_message: 'ログアウトしますか？再度ログインが必要になります。',
    auth_logout_confirm_button: 'ログアウト',
    auth_email: 'メール',
    auth_password: 'パスワード',
    auth_display_name: '表示名（任意）',
    auth_login_title: 'ログイン',
    auth_register_title: '登録',
    auth_login_button: 'ログイン',
    auth_register_button: '登録',
    auth_cancel_button: 'キャンセル',
    auth_switch_to_login: 'アカウントをお持ちですか？ログイン',
    auth_switch_to_register: 'アカウントがありませんか？登録',
    auth_login_subtitle: 'おかえりなさい。ログインしてください。',
    auth_register_subtitle: '新規登録して学習を始めましょう。',
    auth_email_placeholder: 'メールアドレスを入力',
    auth_password_placeholder: '8-16文字、数字・英字・記号を含む',
    auth_password_rule_length: '8-16文字',
    auth_password_rule_digit: '数字を含む',
    auth_password_rule_letter: '英字を含む',
    auth_password_rule_special: '記号を含む',
    auth_confirm_password: 'パスワード確認',
    auth_confirm_match: '一致',
    auth_confirm_mismatch: '一致しません',
    auth_captcha_label: '認証コード',
    auth_captcha_placeholder: '画像の文字を入力',
    auth_captcha_refresh: '更新',
    auth_error_invalid_captcha: '認証コードが無効または期限切れです',
    auth_confirm_password_placeholder: 'パスワードを再入力',
    auth_show_password: '表示',
    auth_hide_password: '非表示',
    auth_display_name_placeholder: 'ニックネーム',
    auth_error_invalid_credentials: 'メールまたはパスワードが正しくありません',
    auth_error_user_not_found: 'ユーザーが見つかりません',
    auth_error_wrong_password: 'パスワードが違います',
    auth_error_password_mismatch: 'パスワードが一致しません',
    auth_login_success: 'ログイン成功',
    auth_register_success: '登録に成功しました。ログインしてください',
    auth_error_weak_password: 'パスワードは8-16文字で、数字・英字・記号を含めてください',
    auth_error_email_taken: 'このメールは既に使用されています',
    auth_error_invalid_email: '有効なメールアドレスを入力してください',
    auth_error_invalid_input: '入力が無効です',
    auth_error_unauthorized: '認証が必要です',
    auth_error_request_failed: 'リクエストに失敗しました',
    auth_error_login_failed: 'ログインに失敗しました',
    auth_error_register_failed: '登録に失敗しました',
    auth_error_logout_failed: 'ログアウトに失敗しました',
    auth_error_network: 'ネットワークエラー',
    auth_error_unknown: '不明なエラー',
    auth_loading: '読み込み中...',
    profile_title: 'プロフィール',
    profile_display_name: 'ニックネーム',
    profile_display_name_placeholder: 'ニックネームを入力',
    profile_display_name_rule: '1-20文字、英数字・スペース・- _ . のみ',
    profile_error_invalid_display_name: '形式が無効です。1-20文字で英数字・スペース・- _ . のみ使用してください。',
    profile_save: '保存',
    profile_saved: '保存しました',
    note_hiragana_label: 'ひらがなメモ',
    note_katakana_label: 'カタカナメモ',
    note_placeholder: '覚え方を入力...',
    note_image_label: '画像メモ',
    note_add_image: '画像を追加',
    note_delete: '削除',
    note_save: '保存',
    note_cancel: 'キャンセル',
    note_hiragana_short: 'ひ',
    note_katakana_short: 'カ',
    note_image_only: '（画像のみ）',
    note_add_hiragana: 'ひらがなメモを追加',
    note_add_katakana: 'カタカナメモを追加',
    note_label: 'メモ',
    note_view_image: '拡大表示',
    note_prev_image: '前へ',
    note_next_image: '次へ',
  },
};

export function t(lang: Language, key: string): string {
  // Hardcoded test values for common auth keys
  const hardcodedValues: Record<string, Record<Language, string>> = {
    'auth_login_title': { zh: '登录', en: 'Login', ja: 'ログイン' },
    'auth_register_title': { zh: '注册', en: 'Register', ja: '登録' },
    'auth_login_button': { zh: '登录', en: 'Login', ja: 'ログイン' },
    'auth_register_button': { zh: '注册', en: 'Register', ja: '登録' },
    'auth_email': { zh: '邮箱', en: 'Email', ja: 'メール' },
    'auth_password': { zh: '密码', en: 'Password', ja: 'パスワード' },
    'auth_display_name': { zh: '显示名称（可选）', en: 'Display name (optional)', ja: '表示名（任意）' },
    'auth_email_placeholder': { zh: '请输入邮箱', en: 'Enter your email', ja: 'メールアドレスを入力' },
    'auth_password_placeholder': { zh: '至少8位字符', en: 'At least 8 characters', ja: '8-16文字、数字・英字・記号を含む' },
    'auth_display_name_placeholder': { zh: '您的昵称', en: 'Your nickname', ja: 'ニックネーム' },
    'auth_login_subtitle': { zh: '欢迎回来，请登录您的账户', en: 'Welcome back, please sign in to your account', ja: 'おかえりなさい。ログインしてください。' },
    'auth_register_subtitle': { zh: '创建新账户开始学习', en: 'Create a new account to start learning', ja: '新規登録して学習を始めましょう。' },
    'auth_switch_to_login': { zh: '已有账号？登录', en: 'Already have an account? Login', ja: 'アカウントをお持ちですか？ログイン' },
    'auth_switch_to_register': { zh: '没有账号？注册', en: 'No account? Register', ja: 'アカウントがありませんか？登録' },
    'auth_loading': { zh: '加载中...', en: 'Loading...', ja: '読み込み中...' },
    'auth_error_invalid_credentials': { zh: '邮箱或密码错误', en: 'Email or password incorrect', ja: 'メールまたはパスワードが正しくありません' },
    'auth_error_user_not_found': { zh: '用户不存在', en: 'User not found', ja: 'ユーザーが見つかりません' },
    'auth_error_wrong_password': { zh: '密码错误', en: 'Wrong password', ja: 'パスワードが違います' },
    'auth_error_email_taken': { zh: '该邮箱已被使用', en: 'This email is already in use', ja: 'このメールは既に使用されています' },
    'auth_error_invalid_email': { zh: '请输入有效的邮箱格式', en: 'Please enter a valid email address', ja: '有効なメールアドレスを入力してください' },
    'auth_error_invalid_input': { zh: '输入无效', en: 'Invalid input', ja: '入力が無効です' },
    'auth_error_unauthorized': { zh: '未授权', en: 'Unauthorized', ja: '認証が必要です' },
    'auth_error_request_failed': { zh: '请求失败', en: 'Request failed', ja: 'リクエストに失敗しました' },
    'auth_error_login_failed': { zh: '登录失败', en: 'Login failed', ja: 'ログインに失敗しました' },
    'auth_error_register_failed': { zh: '注册失败', en: 'Registration failed', ja: '登録に失敗しました' },
    'auth_error_network': { zh: '网络错误', en: 'Network error', ja: 'ネットワークエラー' },
    'auth_error_unknown': { zh: '未知错误', en: 'Unknown error', ja: '不明なエラー' },
    'nav_learn': { zh: '学习', en: 'Learn', ja: '学習' },
    'nav_greetings': { zh: '寒暄语', en: 'Greetings', ja: '挨拶' },
    'nav_practice': { zh: '练习', en: 'Practice', ja: '練習' },
    'lang_zh': { zh: '中文', en: 'Chinese', ja: '中国語' },
    'lang_en': { zh: '英文', en: 'English', ja: '英語' },
    'lang_ja': { zh: '日文', en: 'Japanese', ja: '日本語' },
  };

  if (hardcodedValues[key]) {
    return hardcodedValues[key][lang] || hardcodedValues[key].zh || hardcodedValues[key].en;
  }

  const dict = dictionaries[lang];
  const fallbackDict = dictionaries.zh;
  
  // Try current language first, then Chinese
  if (dict && dict[key]) return dict[key];
  if (fallbackDict && fallbackDict[key]) return fallbackDict[key];
  
  // For auth errors, provide user-friendly fallbacks
  if (key.startsWith('auth_error_')) {
    const errorMessages: Record<string, Record<Language, string>> = {
      'auth_error_unauthorized': { zh: '未授权', en: 'Unauthorized', ja: '認証が必要です' },
      'auth_error_request_failed': { zh: '请求失败', en: 'Request failed', ja: 'リクエストに失敗しました' },
      'auth_error_login_failed': { zh: '登录失败', en: 'Login failed', ja: 'ログインに失敗しました' },
      'auth_error_register_failed': { zh: '注册失败', en: 'Registration failed', ja: '登録に失敗しました' },
      'auth_error_weak_password': { zh: '密码需为 8-16 位，且包含数字、英文字母和特殊字符', en: 'Password must be 8-16 characters and include number, letter and special character', ja: 'パスワードは8-16文字で、数字・英字・記号を含めてください' },
      'auth_error_invalid_captcha': { zh: '验证码错误或已过期，请重新获取', en: 'Invalid or expired captcha, please refresh', ja: '認証コードが無効または期限切れです' },
    };

    if (errorMessages[key]) {
      return errorMessages[key][lang] || errorMessages[key].zh || errorMessages[key].en;
    }
    
    return lang === 'zh' ? '发生错误' : lang === 'ja' ? 'エラーが発生しました' : 'An error occurred';
  }
  
  // For other keys, return the key itself as fallback
  return key;
}
